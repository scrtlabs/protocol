

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing a Secret Contract &mdash; Enigma Protocol 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/css/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Enigma Protocol 0.1 documentation" href="index.html"/>
        <link rel="next" title="Creating a React Front-End" href="CreateReactFrontend.html"/>
        <link rel="prev" title="Getting Started" href="GettingStarted.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> Enigma Protocol
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="HowToUseThisDocumentation.html">How to use this Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="AboutThisRelease.html">About this Release</a><ul>
<li class="toctree-l2"><a class="reference internal" href="AboutThisRelease.html#selected-features-of-this-release">Selected features of this release</a></li>
<li class="toctree-l2"><a class="reference internal" href="AboutThisRelease.html#assumptions-made-in-this-testnet-release">Assumptions made in this testnet release</a></li>
<li class="toctree-l2"><a class="reference internal" href="AboutThisRelease.html#on-rust">On Rust</a></li>
<li class="toctree-l2"><a class="reference internal" href="AboutThisRelease.html#on-sgx">On SGX</a></li>
<li class="toctree-l2"><a class="reference internal" href="AboutThisRelease.html#on-coupling-with-ethereum">On Coupling with Ethereum</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="GettingStarted.html#frequently-asked-questions">Frequently Asked Questions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="GettingStarted.html#hardware-and-software-mode-what-s-the-difference">Hardware and software mode - what’s the difference?</a></li>
<li class="toctree-l3"><a class="reference internal" href="GettingStarted.html#how-do-i-know-if-my-system-has-an-sgx-enabled-cpu">How do I know if my system has an SGX-enabled CPU?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="GettingStarted.html#testnet-limitations">Testnet Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="GettingStarted.html#system-requirements">System Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="GettingStarted.html#setting-up-the-testnet">Setting up the Testnet</a></li>
<li class="toctree-l2"><a class="reference internal" href="GettingStarted.html#deploying-the-network">Deploying the Network</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Writing a Secret Contract</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example-the-millionaires-problem">Example: The Millionaires Problem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="CreateReactFrontend.html">Creating a React Front-End</a><ul>
<li class="toctree-l2"><a class="reference internal" href="CreateReactFrontend.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="SystemDesign.html">System Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="SystemDesign.html#enigma-js-client-library">Enigma-JS Client Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="SystemDesign.html#enigma-contract">Enigma Contract</a><ul>
<li class="toctree-l3"><a class="reference internal" href="SystemDesign.html#tracking-of-computation-tasks">Tracking of Computation Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="SystemDesign.html#events">Events</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="SystemDesign.html#principal-node">Principal Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="SystemDesign.html#enigma-node">Enigma Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="SystemDesign.html#surface">Surface</a></li>
<li class="toctree-l2"><a class="reference internal" href="SystemDesign.html#core">Core</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Enigma-js.html">Enigma-JS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Enigma-js.html#validatekeyhex"><strong>validateKeyHex</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="Enigma-js.html#getderivedkey"><strong>getDerivedKey</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="Enigma-js.html#encryptmessage"><strong>encryptMessage</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="Enigma-js.html#getpublickey"><strong>getPublicKey</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="Enigma-js.html#removetrailing0x"><strong>removeTrailing0x</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="Enigma-js.html#recoverpubkey"><strong>recoverPubKey</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="Enigma-js.html#verifysignature"><strong>verifySignature</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="Enigma-js.html#selectworker"><strong>selectWorker</strong></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="NetworkTopology.html">Network Topology</a></li>
<li class="toctree-l1"><a class="reference internal" href="Community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="SoftwareArchitecture.html">Software Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="SoftwareArchitecture.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="SoftwareArchitecture.html#subsystem-decomposition">Subsystem Decomposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="SoftwareArchitecture.html#logical-components">Logical Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="SoftwareArchitecture.html#mapping-between-subsystems-and-logical-components">Mapping Between Subsystems and Logical Components</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="SubsystemArchitecture.html">Subsystem Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="SubsystemArchitecture.html#registration">Registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="SubsystemArchitecture.html#client-encryption-and-storage">Client Encryption and Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="SubsystemArchitecture.html#worker-selection">Worker Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="SubsystemArchitecture.html#computation">Computation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="SubsystemArchitecture.html#payment-of-the-computation-fee">Payment of the Computation Fee</a></li>
<li class="toctree-l3"><a class="reference internal" href="SubsystemArchitecture.html#deserialization-and-decryption">Deserialization and Decryption</a></li>
<li class="toctree-l3"><a class="reference internal" href="SubsystemArchitecture.html#preprocessing">Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="SubsystemArchitecture.html#execution-in-evm">Execution in EVM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="SubsystemArchitecture.html#on-chain-verification">On-Chain Verification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="SubsystemArchitecture.html#after-each-new-epoch">After Each New Epoch</a></li>
<li class="toctree-l3"><a class="reference internal" href="SubsystemArchitecture.html#post-computation">Post Computation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="SubsystemArchitecture.html#attestation">Attestation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="License.html">License</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Enigma Protocol</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Writing a Secret Contract</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/SecretContracts.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="writing-a-secret-contract">
<h1>Writing a Secret Contract<a class="headerlink" href="#writing-a-secret-contract" title="Permalink to this headline">¶</a></h1>
<p>Secret contracts are smart contracts that execute code over Enigma’s decentralized
network without revealing input data, ensuring both integrity and confidentiality. Secret
contracts are written in a programming language called Solidity, and are implemented
very similarly to Ethereum-based smart contracts.</p>
<p><strong>NOTICE:</strong> Although the <code class="docutils literal"><span class="pre">enigma-docker-network</span></code> must stay running, at this point in the
guide you will be operating entirely out of the
<code class="docutils literal"><span class="pre">enigma-template-dapp</span></code> folder (the <code class="docutils literal"><span class="pre">dapp</span></code> terminal).</p>
<div class="section" id="example-the-millionaires-problem">
<h2>Example: The Millionaires Problem<a class="headerlink" href="#example-the-millionaires-problem" title="Permalink to this headline">¶</a></h2>
<p>The millionaires problem is a simple concept with complex solutions: How do two
individuals compare their net worth without ever exposing their actual value to
the other party?</p>
<p>Inside your <code class="docutils literal"><span class="pre">dapp</span></code> terminal, enter the <code class="docutils literal"><span class="pre">/contracts</span></code> folder and create a new
file called <code class="docutils literal"><span class="pre">MillionairesProblem.sol</span></code> and paste the following contract code within
it:</p>
<div class="highlight-rust"><div class="highlight"><pre><span class="n">pragma</span><span class="w"> </span><span class="n">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">17</span><span class="p">;</span><span class="w"></span>


<span class="n">contract</span><span class="w"> </span><span class="n">MillionairesProblem</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="c1">// Stores # of millionaires that have joined and stated their net worths</span>
<span class="w">       </span><span class="kt">uint</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">numMillionaires</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="c1">// Stores Millionaire structs (defined below)</span>
<span class="w">       </span><span class="n">Millionaire</span><span class="p">[]</span><span class="w"> </span><span class="n">millionaires</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="c1">// Stores address of richest millionaire; set in callback function below</span>
<span class="w">       </span><span class="n">address</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">richestMillionaire</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="n">address</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">owner</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="n">address</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">enigma</span><span class="p">;</span><span class="w"></span>

<span class="w">       </span><span class="c1">// Millionaire struct which holds encrypted address and net worth</span>
<span class="w">       </span><span class="k">struct</span><span class="w"> </span><span class="n">Millionaire</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="n">bytes</span><span class="w"> </span><span class="n">myAddress</span><span class="p">;</span><span class="w"></span>
<span class="w">               </span><span class="n">bytes</span><span class="w"> </span><span class="n">myNetWorth</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="p">}</span><span class="w"></span>

<span class="w">       </span><span class="c1">// Event emitted upon callback completion; watched from front end</span>
<span class="w">       </span><span class="n">event</span><span class="w"> </span><span class="n">CallbackFinished</span><span class="p">();</span><span class="w"></span>

<span class="w">       </span><span class="c1">// Modifier to ensure only enigma contract can call function</span>
<span class="w">       </span><span class="n">modifier</span><span class="w"> </span><span class="n">onlyEnigma</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="n">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">enigma</span><span class="p">);</span><span class="w"></span>
<span class="w">               </span><span class="n">_</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="p">}</span><span class="w"></span>

<span class="w">       </span><span class="c1">// Constructor called when new contract is deployed</span>
<span class="w">       </span><span class="n">constructor</span><span class="p">(</span><span class="n">address</span><span class="w"> </span><span class="n">_enigmaAddress</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">_owner</span><span class="p">)</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="n">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_owner</span><span class="p">;</span><span class="w"></span>
<span class="w">               </span><span class="n">enigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_enigmaAddress</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="p">}</span><span class="w"></span>

<span class="w">       </span><span class="c1">// Add a new millionaire with encrypted address and net worth arguments</span>
<span class="w">       </span><span class="n">function</span><span class="w"> </span><span class="n">addMillionaire</span><span class="p">(</span><span class="n">bytes</span><span class="w"> </span><span class="n">_encryptedAddress</span><span class="p">,</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="n">_encryptedNetWorth</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">public</span><span class="w"></span>
<span class="w">       </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="n">Millionaire</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">millionaire</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Millionaire</span><span class="p">({</span><span class="w"></span>
<span class="w">                       </span><span class="n">myAddress</span><span class="o">:</span><span class="w"> </span><span class="n">_encryptedAddress</span><span class="p">,</span><span class="w"></span>
<span class="w">                       </span><span class="n">myNetWorth</span><span class="o">:</span><span class="w"> </span><span class="n">_encryptedNetWorth</span><span class="w"></span>
<span class="w">               </span><span class="p">});</span><span class="w"></span>
<span class="w">               </span><span class="n">millionaires</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">millionaire</span><span class="p">);</span><span class="w"></span>
<span class="w">               </span><span class="n">numMillionaires</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="p">}</span><span class="w"></span>

<span class="w">       </span><span class="c1">// Return encrypted address and net worth for a particular millionaire</span>
<span class="w">       </span><span class="n">function</span><span class="w"> </span><span class="n">getInfoForMillionaire</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">public</span><span class="w"></span>
<span class="w">               </span><span class="n">view</span><span class="w"></span>
<span class="w">               </span><span class="n">returns</span><span class="w"> </span><span class="p">(</span><span class="n">bytes</span><span class="p">,</span><span class="w"> </span><span class="n">bytes</span><span class="p">)</span><span class="w"></span>
<span class="w">       </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="n">Millionaire</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">millionaire</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">millionaires</span><span class="p">[</span><span class="n">index</span><span class="p">];</span><span class="w"></span>
<span class="w">               </span><span class="n">bytes</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">encryptedAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">millionaire</span><span class="p">.</span><span class="n">myAddress</span><span class="p">;</span><span class="w"></span>
<span class="w">               </span><span class="n">bytes</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">encryptedNetWorth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">millionaire</span><span class="p">.</span><span class="n">myNetWorth</span><span class="p">;</span><span class="w"></span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">encryptedAddress</span><span class="p">,</span><span class="w"> </span><span class="n">encryptedNetWorth</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="p">}</span><span class="w"></span>

<span class="w">       </span><span class="cm">/*</span>
<span class="cm">       CALLABLE FUNCTION run in SGX to decipher encrypted net worths to</span>
<span class="cm">       determine richest millionaire</span>
<span class="cm">       */</span><span class="w"></span>
<span class="w">       </span><span class="n">function</span><span class="w"> </span><span class="n">computeRichest</span><span class="p">(</span><span class="n">address</span><span class="p">[]</span><span class="w"> </span><span class="n">_addresses</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="n">_netWorths</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">public</span><span class="w"></span>
<span class="w">               </span><span class="kr">pure</span><span class="w"></span>
<span class="w">               </span><span class="n">returns</span><span class="w"> </span><span class="p">(</span><span class="n">address</span><span class="p">)</span><span class="w"></span>
<span class="w">       </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="kt">uint</span><span class="w"> </span><span class="n">maxIndex</span><span class="p">;</span><span class="w"></span>
<span class="w">               </span><span class="kt">uint</span><span class="w"> </span><span class="n">maxValue</span><span class="p">;</span><span class="w"></span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">_netWorths</span><span class="p">.</span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_netWorths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">maxValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                               </span><span class="n">maxValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_netWorths</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="w">                               </span><span class="n">maxIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">                       </span><span class="p">}</span><span class="w"></span>
<span class="w">               </span><span class="p">}</span><span class="w"></span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="n">_addresses</span><span class="p">[</span><span class="n">maxIndex</span><span class="p">];</span><span class="w"></span>
<span class="w">       </span><span class="p">}</span><span class="w"></span>

<span class="w">       </span><span class="cm">/*</span>
<span class="cm">       CALLBACK FUNCTION to change contract state tracking richest</span>
<span class="cm">       millionaire&#39;s name</span>
<span class="cm">       */</span><span class="w"></span>
<span class="w">       </span><span class="n">function</span><span class="w"> </span><span class="n">setRichestAddress</span><span class="p">(</span><span class="n">address</span><span class="w"> </span><span class="n">_address</span><span class="p">)</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">onlyEnigma</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="n">richestMillionaire</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_address</span><span class="p">;</span><span class="w"></span>
<span class="w">               </span><span class="n">emit</span><span class="w"> </span><span class="n">CallbackFinished</span><span class="p">();</span><span class="w"></span>
<span class="w">       </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>As mentioned above, the design principles and syntax (state variables, structs, constructors,
functions, events, modifiers, etc.) are very similar to Ethereum smart contracts, the two major
differences being the <code class="docutils literal"><span class="pre">callable</span></code> and <code class="docutils literal"><span class="pre">callback</span></code> functions.</p>
<dl class="docutils">
<dt>Callable</dt>
<dd>This is a public function that runs secret computations inside the SGX enclave. It is a <code class="docutils literal"><span class="pre">pure</span></code>
function, meaning it does not read from nor write to the contract state, but computes solely
off of the arguments that are passed to it. Although these encrypted values are passed via
the front-end interface, the decryption automatically occurs within this function.
In the case of this <code class="docutils literal"><span class="pre">computeRichest</span></code> callable example, the arguments take the form
of <code class="docutils literal"><span class="pre">_addresses</span></code> and <code class="docutils literal"><span class="pre">_netWorths</span></code> - more specifically, types <code class="docutils literal"><span class="pre">address[]</span></code> and <code class="docutils literal"><span class="pre">uint[]</span></code>.
These arguments are decrypted automatically, and it is now possible to determine the party with
the highest net worth and retrieve the decrypted address at the same index. This decrypted
address is to be used as the input for the <code class="docutils literal"><span class="pre">callback</span></code> function.</dd>
<dt>Callback</dt>
<dd>This is a public function automatically called by the worker (the <code class="docutils literal"><span class="pre">onlyEnigma()</span></code> modifier)
after the callable function is completed. It is responsible for committing the results and
altering the contract state. In this example, we input the <code class="docutils literal"><span class="pre">_address</span></code> we’ve obtained from the
<code class="docutils literal"><span class="pre">callable</span></code>, store it as the <code class="docutils literal"><span class="pre">richestMillionaire</span></code> state variable, and emit the
<code class="docutils literal"><span class="pre">CallbackFinished</span></code> event. The output of the final event is important, as it is possible to set
up an event watcher within the front-end to perform a task upon successful completion.</dd>
</dl>
<p>The next step is to create a contract ‘factory design pattern’ so fresh instances of the
<code class="docutils literal"><span class="pre">MillionairesProblem</span></code> can be generated on-demand. From the <code class="docutils literal"><span class="pre">/contracts</span></code> folder, create a new
file called <code class="docutils literal"><span class="pre">MillionairesProblemFactory.sol</span></code> and paste the following code:</p>
<div class="highlight-rust"><div class="highlight"><pre><span class="n">pragma</span><span class="w"> </span><span class="n">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">17</span><span class="p">;</span><span class="w"></span>
<span class="n">import</span><span class="w"> </span><span class="s">&quot;./MillionairesProblem.sol&quot;</span><span class="p">;</span><span class="w"></span>


<span class="n">contract</span><span class="w"> </span><span class="n">MillionairesProblemFactory</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="n">address</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">enigmaAddress</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="c1">// List of addresses for deployed MillionaireProblem instances</span>
<span class="w">       </span><span class="n">address</span><span class="p">[]</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">millionairesProblems</span><span class="p">;</span><span class="w"></span>

<span class="w">       </span><span class="n">constructor</span><span class="p">(</span><span class="n">address</span><span class="w"> </span><span class="n">_enigmaAddress</span><span class="p">)</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="n">enigmaAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_enigmaAddress</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="p">}</span><span class="w"></span>

<span class="w">       </span><span class="c1">// Create a new MillionaireProblem and store address to array</span>
<span class="w">       </span><span class="n">function</span><span class="w"> </span><span class="n">createNewMillionairesProblem</span><span class="p">()</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="n">address</span><span class="w"> </span><span class="n">newMillionairesProblem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MillionairesProblem</span><span class="p">(</span><span class="w"></span>
<span class="w">                       </span><span class="n">enigmaAddress</span><span class="p">,</span><span class="w"></span>
<span class="w">                       </span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="w"></span>
<span class="w">               </span><span class="p">);</span><span class="w"></span>
<span class="w">               </span><span class="n">millionairesProblems</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">newMillionairesProblem</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="p">}</span><span class="w"></span>

<span class="w">       </span><span class="c1">// Obtain list of all deployed MillionaireProblem instances</span>
<span class="w">       </span><span class="n">function</span><span class="w"> </span><span class="n">getMillionairesProblems</span><span class="p">()</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="p">(</span><span class="n">address</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="n">millionairesProblems</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>All of the necessary solidity code has been completed at this point. The final step is to
implement a migration script that will deploy the <code class="docutils literal"><span class="pre">MillionairesProblemFactory</span></code> contract.
From within the <code class="docutils literal"><span class="pre">migrations/</span></code> folder, create a script called <code class="docutils literal"><span class="pre">2_deploy_millionaires_problem_factory.js</span></code>
and paste the following:</p>
<div class="highlight-rust"><div class="highlight"><pre><span class="kr">const</span><span class="w"> </span><span class="n">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s">&quot;http&quot;</span><span class="p">);</span><span class="w"></span>
<span class="kr">const</span><span class="w"> </span><span class="n">MillionairesProblemFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artifacts</span><span class="p">.</span><span class="n">require</span><span class="p">(</span><span class="w"></span>
<span class="w">   </span><span class="s">&quot;MillionairesProblemFactory.sol&quot;</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>

<span class="n">module</span><span class="p">.</span><span class="n">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">deployer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">       </span><span class="n">deployer</span><span class="w"></span>
<span class="w">           </span><span class="p">.</span><span class="n">then</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Promise</span><span class="p">((</span><span class="n">resolve</span><span class="p">,</span><span class="w"> </span><span class="n">reject</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                   </span><span class="cm">/*</span>
<span class="cm">                   Obtain the Enigma contract address hosted at this port</span>
<span class="cm">                   upon enigma-docker-network launch</span>
<span class="cm">                   */</span><span class="w"></span>
<span class="w">                   </span><span class="kr">const</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">http</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="w"></span>
<span class="w">                       </span><span class="s">&quot;http://localhost:8081&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                       </span><span class="n">response</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">                               </span><span class="n">response</span><span class="p">.</span><span class="n">statusCode</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="o">||</span><span class="w"></span>
<span class="w">                               </span><span class="n">response</span><span class="p">.</span><span class="n">statusCode</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">299</span><span class="w"></span>
<span class="w">                           </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                               </span><span class="n">reject</span><span class="p">(</span><span class="w"></span>
<span class="w">                                   </span><span class="n">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="w"></span>
<span class="w">                                       </span><span class="s">&quot;Failed to load page, status code: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">                                           </span><span class="n">response</span><span class="p">.</span><span class="n">statusCode</span><span class="w"></span>
<span class="w">                                   </span><span class="p">)</span><span class="w"></span>
<span class="w">                               </span><span class="p">);</span><span class="w"></span>
<span class="w">                           </span><span class="p">}</span><span class="w"></span>
<span class="w">                           </span><span class="kr">const</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="w">                           </span><span class="n">response</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">chunk</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">body</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">chunk</span><span class="p">));</span><span class="w"></span>
<span class="w">                           </span><span class="n">response</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">resolve</span><span class="p">(</span><span class="n">body</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)));</span><span class="w"></span>
<span class="w">                       </span><span class="p">}</span><span class="w"></span>
<span class="w">                   </span><span class="p">);</span><span class="w"></span>
<span class="w">                   </span><span class="n">request</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;error&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">reject</span><span class="p">(</span><span class="n">err</span><span class="p">));</span><span class="w"></span>
<span class="w">               </span><span class="p">});</span><span class="w"></span>
<span class="w">           </span><span class="p">})</span><span class="w"></span>
<span class="w">           </span><span class="c1">// Deploy MillionairesProblemFactory with the Enigma contract address</span>
<span class="w">           </span><span class="p">.</span><span class="n">then</span><span class="p">(</span><span class="n">enigmaAddress</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Got Enigma Contract address: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">enigmaAddress</span><span class="p">);</span><span class="w"></span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="n">deployer</span><span class="p">.</span><span class="n">deploy</span><span class="p">(</span><span class="w"></span>
<span class="w">                   </span><span class="n">MillionairesProblemFactory</span><span class="p">,</span><span class="w"></span>
<span class="w">                   </span><span class="n">enigmaAddress</span><span class="w"></span>
<span class="w">               </span><span class="p">);</span><span class="w"></span>
<span class="w">           </span><span class="p">})</span><span class="w"></span>
<span class="w">           </span><span class="p">.</span><span class="n">catch</span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">console</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="p">);</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>The function of this script is to pass the Enigma contract address that was deployed
when the Docker container was launched ( found at <code class="docutils literal"><span class="pre">http://localhost:8081</span></code>), and deploy
a fresh <code class="docutils literal"><span class="pre">MillionairesProblemFactory</span></code> instance with this address as an argument.</p>
<p><strong>NOTICE:</strong> To create new contracts or modify existing ones, you must redeploy to the network with the
following command: <code class="docutils literal"><span class="pre">darq-truffle</span> <span class="pre">migrate</span> <span class="pre">--reset</span> <span class="pre">--network</span> <span class="pre">development</span></code></p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="CreateReactFrontend.html" class="btn btn-neutral float-right" title="Creating a React Front-End" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="GettingStarted.html" class="btn btn-neutral" title="Getting Started" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018 Enigma MPC, Inc.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>